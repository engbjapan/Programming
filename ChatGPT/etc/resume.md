# APIGateway及びAWS Lambdaによる移行に関するレジュメ

## １．概要
- APIGatewayは、クラウドベースのウェブサービスであり、API管理と展開のためのツールです。APIGatewayはHTTPリクエストを受け取り、適切な処理にルーティングし、バックエンドのAWS Lambda関数や他のサービスと連携してAPIを提供します。

## ２．MVCモデルとの統合
- MVCモデルは、Webサービスの設計パターンであり、モデル（データやビジネスロジック）、ビュー（ユーザーインターフェース）、コントローラ（処理の制御）の3つの要素から構成されます。
- APIGatewayとAWS Lambdaを組み合わせることで、MVCモデルのコントローラとモデルを構築できます。

## ３．クライアントサイドの処理移行
- 既存システムでは、サーバーサイドでビューの生成処理が行われていました。今回のクライアントサイドへの処理移行により、処理の負荷分散が行われ、ユーザーエクスペリエンスの向上が期待できます。
- クライアントサイドでのビューの生成処理移行には、APIGatewayを介してクライアントに必要なデータを提供する方法があります。APIGatewayは、クライアントからのRESTfulなリクエストを受け取り、バックエンドのAWS Lambda関数を呼び出してデータを取得し、クライアントに返します。

## ４．RESTfulアーキテクチャとAPIGateway
- RESTfulアーキテクチャは、Webサービスの設計原則の一つであり、シンプルで拡張性のあるAPIを提供するためのアーキテクチャです。
- APIGatewayは、RESTfulなAPIの構築をサポートします。APIGatewayを使用することで、APIのエンドポイントやリソースの設計、HTTPメソッドのマッピングなどを行うことができます。

## ５．セッション管理と認証/承認
- セッション管理は、ユーザーの状態を追跡し、セキュアな環境でユーザーの認証情報を管理する仕組みです。
- APIGatewayでは、クライアントからのリクエストに対してセッション管理を実現するためのカスタム認証/承認を設定できます。例えば、AWS Lambda関数を使用して認証や承認の処理を行うことが可能です。AWS Identity and Access Management (IAM)やAmazon Cognitoと組み合わせることで、セキュアな認証/承認機構を実装できます。

具体的な手順は以下の通りです。
  1. Lambda関数の作成: 認証/承認のロジックを含むLambda関数を作成します。この関数は、APIGatewayからのリクエストを受け取り、認証や承認の処理を行います。
  2. API Gatewayの設定: APIGatewayのリソースやメソッドに対して、カスタム認証/承認を有効にする設定を行います。認証/承認のためのLambda関数を指定し、リクエストの検証や承認処理を行うように設定します。
  3. 認証の実装: Lambda関数内で、クライアントの認証情報を検証します。例えば、ユーザ名とパスワードの組み合わせやトークンベースの認証などが一般的な方法です。
  4. 承認の実装: 認証が成功した場合、Lambda関数内でクライアントのアクセス権限をチェックし、リクエストの承認可否を判断します。例えば、ロールベースのアクセス制御や特定の条件に基づいたアクセス制限などが行われます。
  5. レスポンスの生成: 認証/承認の結果に応じて、Lambda関数内で必要なレスポンスを生成します。成功した場合はリクエストを許可する旨のレスポンスを生成し、失敗した場合はエラーメッセージや適切なステータスコードを返します。

## ６．データベースとの連携
- AWS Lambdaは、データベースとの連携にはさまざまな方法を提供しています。例えば、以下の手順を経てデータベースへのアクセスとデータの取得や更新を行うことができます。
  1. AWS Lambda関数の作成と設定: AWS Management ConsoleやAWS CLIを使用して、Lambda関数を作成し設定します。関数の実行ロールには、データベースへのアクセス権限を持つIAMロールを割り当てます。
  2. データベースの選択:AWS Lambda関数内で使用するデータベースを選択します。AWSでは、Amazon DynamoDB、Amazon RDS（Relational Database Service）、Amazon Auroraなど、さまざまなデータベースサービスを提供しています。（**データベース移行チームと協議**が必要です。）
  3. クライアントライブラリの使用: 選択したデータベースにアクセスするために、Lambda関数内でデータベースクライアントライブラリを使用します。例えば、Pythonの場合はBoto3ライブラリを使用することが一般的です。 （現時点では、Lambda関数が呼び出すライブラリの言語選定ができておりませんが、**既存システムのビジネスロジックを記載する言語がC#であれば、プログラムコードの移植性と処理能力を考慮してJava言語を検討**してください。）
  4. データベースへのクエリ実行: Lambda関数内で必要なクエリを作成し、データベースに対して実行します。データの取得、更新、削除など、必要な操作を実行できます。

## ７．利点とメリット
- APIGatewayとAWS Lambdaを組み合わせることにより、以下の利点とメリットがあります：
  - 拡張性: リクエストの処理を分散することで、スケーラビリティと拡張性が向上します。APIGatewayとLambdaは、必要に応じて自動的にリクエストの処理をスケールアップまたはスケールダウンさせることができます。
  - コスト効率: Lambda関数のペイパーリクエストの課金モデルにより、リクエストが発生しない場合は料金が発生しません。また、必要なリソースだけを使用するため、コスト効率が高くなります。
  - セキュリティ: APIGatewayによるカスタム認証/承認の設定や、AWSのセキュリティサービスとの統合により、セキュアなAPIの提供が可能です。

